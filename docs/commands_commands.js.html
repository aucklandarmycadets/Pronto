<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Pronto: commands/commands.js</title>
    
      <link type="text/css" rel="stylesheet" href="styles/vendor/prism-okaidia.css">
    
    <link type="text/css" rel="stylesheet" href="styles/styles.css">
    
    
    <style>
      :root {
      
      }
    </style>
    
</head>
<body>

<header class="layout-header">
  
  <h1>
    <a href="./index.html">
      Pronto
    </a>
  </h1>
  <nav class="layout-nav">
    <ul><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands.html">commands</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_approve.html">commands/approve</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_approve.html#~processMentions">processMentions</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_archive.html">commands/archive</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_assign.html">commands/assign</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_assign.html#~getUserInput">getUserInput</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_assign.html#~msgPrompt">msgPrompt</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_assign.html#~processMentions">processMentions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_assign.html#~whileLoop">whileLoop</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_attendance.html">commands/attendance</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_connected.html">commands/connected</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_evaluate.html">commands/evaluate</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_evaluate.html#~convertToString">convertToString</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_evaluate.html#~findBreakIndex">findBreakIndex</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_evaluate.html#~removeSensitive">removeSensitive</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_help.html">commands/help</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_leave.html">commands/leave</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_leavefor.html">commands/leavefor</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_lesson.html">commands/lesson</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_lesson.html#~getNumberInput">getNumberInput</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_lesson.html#~processMentions">processMentions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_lesson.html#~serialiseResources">serialiseResources</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_ping.html">commands/ping</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_purge.html">commands/purge</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_restart.html">commands/restart</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_seen.html">commands/seen</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_uptime.html">commands/uptime</a></span></li></ul><ul><li class="nav-heading">Namespaces</li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="commands.html">commands</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="handlers.html">handlers</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="handlers.html#.commandLoader">commandLoader</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="models.html">models</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="modules.html">modules</a></span></li></ul>
  </nav>
</header>


<main class="layout-main  layout-content--source">
  <div class="container">
    <p class="page-kind">source</p>
    <h1 class="page-title">commands/commands.js</h1>
    



    

<section>
    <article>
        <pre id="source" class="source-page line-numbers"><code class="language-js">'use strict';

// eslint-disable-next-line no-unused-vars
const Discord = require('discord.js');
// eslint-disable-next-line no-unused-vars
const Typings = require('../typings');

const { ids: { DEVELOPER_ID } } = require('./config');
const { formatList } = require('./modules');

/**
 * @namespace commands
 */

/**
 * @typedef {string} commands.CommandName The name of the command
 */

/**
 * @typedef {Object} commands.CommandBase The base of each of Pronto's commands, with the base properties to construct a complete [\&lt;Command>]{@link commands.Command}
 * @property {commands.CommandName} command The name of the command
 * @property {string[]} aliases The aliases for the command
 * @property {string} description The description of the command
 * @property {boolean} allowDirect Whether to allow the command to execute from a direct message
 * @property {Discord.Snowflake[]} requiredRoles A &lt;Role.id[]> of which the \&lt;GuildMember> must have at least one to execute the command
 * @property {Discord.Snowflake[]} deniedRoles A &lt;Role.id[]> of which the \&lt;GuildMember> must have none to execute the command
 * @property {boolean} developerOnly Whether the command is only executable by the developer defined by config.ids.DEVELOPER_ID
 * @property {boolean} displayInList Whether to display the command in the guild's commands list
 * @property {string} help The help text to display for the command
 * @property {?string} error The error text to display for the command
*/

/**
 * @typedef {Object.&lt;commands.CommandName, commands.CommandBase>} commands.CommandsBase The base of Pronto's commands object, where each [\&lt;CommandBase>]{@link commands.CommandBase} is stored in the \&lt;CommandsBase> object under the property [{@link commands.CommandName|CommandName}]
 */

/**
 * @typedef {commands.CommandBase} commands.Command The complete \&lt;Command> object for one of Pronto's commands, with a [\&lt;Command.execute()>]{@link commands.Execute} method
 * @property {commands.Execute} execute The command's [\&lt;Command.execute()>]{@link commands.Execute} method
 */

/**
 * @typedef {Object.&lt;commands.CommandName, commands.Command>} commands.Commands The complete \&lt;Commands> object for all of Pronto's commands, where each [\&lt;Command>]{@link commands.Command} is stored in the \&lt;Commands> object under the property [{@link commands.CommandName|CommandName}]
 */

/**
 * @typedef {Function} commands.Execute A command's \&lt;Command.execute()> method
 * @param {commands.CommandParameters} parameters The [\&lt;CommandParameters>]{@link commands.CommandParameters} to execute this command
 * @returns {Promise&lt;void | Typings.Lesson>} Void, or the [\&lt;Lesson>]{@link models.Lesson} object
 */

/**
 * @typedef {Object} commands.CommandParameters An \&lt;Object> of the valid parameters accepted by the [\&lt;Command.execute()>]{@link commands.Execute} method
 * @property {Discord.Message} msg The \&lt;Message> that executed the command, or the \&lt;Message> that the reaction collector was attached to
 * @property {?string[]} args The \&lt;string[]> containing the command arguments
 * @property {?string} msgCommand The message argument that was parsed to this [\&lt;CommandBase>]{@link commands.CommandBase}, i.e. either \&lt;CommandBase.command> or \&lt;CommandBase.aliases.includes(msgCommand)>
 * @property {?Discord.User} user The \&lt;User> that triggered the reaction collector
 */

/**
 *
 * @param {Discord.Guild | 'BREAK'} guild
 * @returns
 */
module.exports = async guild => {
	const { settings: { prefix }, ids } = (guild === 'BREAK')
		? require('./config')
		: await require('./handlers/database')(guild);

	const commands = {
		ping: {
			command: 'ping',
			aliases: ['p'],
			description: 'Test the latency of the bot.',
			allowDirect: true,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: true,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': prefixCommand(this),
				});
			},
			set help(obj) {
				formatList(obj);
			},
		},
		uptime: {
			command: 'uptime',
			aliases: ['up'],
			description: 'Time since last restart.',
			allowDirect: true,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: true,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': prefixCommand(this),
				});
			},
			set help(obj) {
				formatList(obj);
			},
		},
		evaluate: {
			command: 'evaluate',
			aliases: ['eval'],
			description: 'Evaluate Javascript code.',
			allowDirect: true,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: true,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': `${prefixCommand(this)} &lt;code>`,
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		restart: {
			command: 'restart',
			aliases: ['new', 'kill', 'update'],
			description: 'Restart the bot.',
			allowDirect: true,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: true,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': prefixCommand(this),
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		help: {
			command: 'help',
			aliases: ['cmd', 'cmds', 'command', 'commands'],
			description: {
				general: 'Get help with using Pronto.',
				unqualified: 'List of the commands you can use.',
				qualified: 'Get help with a specific command.',
			},
			allowDirect: true,
			requiredRoles: [ids.everyoneID],
			deniedRoles: [],
			developerOnly: false,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description.general,
					'Usage': `${prefixCommand(this)} [command]`,
					'Examples': `\n${prefixCommand(this)}\n${prefixCommand(this)} ${commands.leave.command}`,
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		leave: {
			command: 'leave',
			aliases: ['lv'],
			description: 'Submit a leave request.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': `${prefixCommand(this)} &lt;date(s)> &lt;activity> &lt;reason> [additional remarks]`,
					'Example': `${prefixCommand(this)} 01 Jan for Parade Night due to an appointment`,
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		lesson: {
			command: 'lesson',
			aliases: ['view', 'add', 'remove', 'submit'],
			description: 'Commands to aid in actioning an assigned lesson.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: false,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': prefixCommand(this),
					'Allowed Categories': `&lt;#${ids.lessonsID}>`,
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		seen: {
			command: 'seen',
			aliases: ['ack'],
			description: 'Acknowledge receipt of a lesson warning.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: false,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': prefixCommand(this),
					'Allowed Categories': `&lt;#${ids.lessonsID}>`,
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		leaveFor: {
			command: 'leavefor',
			aliases: ['lv4'],
			description: 'Submit a leave request for another cadet.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': `${prefixCommand(this)} &lt;user> &lt;date(s)> &lt;activity> &lt;reason> [additional remarks]`,
					'Example': `${prefixCommand(this)} &lt;@${DEVELOPER_ID}> 01 Jan for Parade Night due to an appointment`,
					'Allowed Roles': rolesOutput(this.requiredRoles),
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		attendance: {
			command: 'attendance',
			aliases: ['att', 'attdnce'],
			description: 'Submit an attendance register.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': `\n${prefixCommand(this)} &lt;message>`,
					'Allowed Roles': rolesOutput(this.requiredRoles),
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		connected: {
			command: 'connected',
			aliases: ['cnnct', 'cnnctd'],
			description: 'List the members connected to a voice channel.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': `${prefixCommand(this)} &lt;voice channel>`,
					'Example': `${prefixCommand(this)} #example-voice`,
					'Allowed Roles': rolesOutput(this.requiredRoles),
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		assign: {
			command: 'assign',
			aliases: ['give'],
			description: 'Assign a lesson to an instructor.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': `${prefixCommand(this)} &lt;user(s)>`,
					'Example': `${prefixCommand(this)} &lt;@${DEVELOPER_ID}>`,
					'Allowed Roles': rolesOutput(this.requiredRoles),
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		approve: {
			command: 'approve',
			aliases: ['app', 'apprv', 'acc', 'accept'],
			description: 'Approve a lesson plan.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': prefixCommand(this),
					'Allowed Roles': rolesOutput(this.requiredRoles),
					'Allowed Categories': `&lt;#${ids.lessonsID}>`,
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		archive: {
			command: 'archive',
			aliases: ['archv'],
			description: 'Archive a text channel.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': `${prefixCommand(this)} &lt;text channel>`,
					'Example': `${prefixCommand(this)} #example-text`,
					'Allowed Roles': rolesOutput(this.requiredRoles),
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
		purge: {
			command: 'purge',
			aliases: ['del', 'delete', 'clear'],
			description: 'Delete a number of messages from a channel.',
			allowDirect: false,
			requiredRoles: [],
			deniedRoles: [],
			developerOnly: false,
			displayInList: true,
			get help() {
				return formatList({
					'Aliases': prefixAlias(this),
					'Description': this.description,
					'Usage': `${prefixCommand(this)} &lt;count> [user]`,
					'Examples': `\n${prefixCommand(this)} 10\n${prefixCommand(this)} 5 &lt;@${DEVELOPER_ID}>`,
					'Allowed Roles': rolesOutput(this.requiredRoles),
				});
			},
			set help(obj) {
				formatList(obj);
			},
			get error() {
				return errorText(this.help, this.command);
			},
			set error(value) {
				errorText(this.help, this.command);
			},
		},
	};

	return commands;

	function rolesOutput(array) {
		return (array)
			? array.filter(id => id !== ids.administratorID &amp;&amp; id !== ids.everyoneID)
				.reduce((mentions, id, i) => mentions + `${(i % 3 === 0) ? '\n' : ''}&lt;@&amp;${id}> `, '')
			: '';
	}

	function errorText(helpText, command) {
		return '\n\n' + helpText + '\n' + formatList({
			'Help Command': `${prefixCommand(commands.help)} ${command}`,
		});
	}

	function prefixCommand(command) {
		return `${prefix}${command.command}`;
	}

	function prefixAlias(command) {
		return [...command.aliases]
			.map(alias => prefix + alias)
			.join(', ');
	}
};</code></pre>
    </article>
</section>




  </div>
</main>

<footer class="layout-footer">
  <div class="container">
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Fri Dec 03 2021 18:03:43 GMT+1300 (New Zealand Daylight Time)
  </div>
</footer>



<script src="scripts/prism.dev.js"></script>
</body>
</html>
