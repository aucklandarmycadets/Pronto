<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Pronto: commands/leavefor.js</title>
    
      <link type="text/css" rel="stylesheet" href="styles/vendor/prism-okaidia.css">
    
    <link type="text/css" rel="stylesheet" href="styles/styles.css">
    
    
    <style>
      :root {
      
      }
    </style>
    
</head>
<body>

<header class="layout-header">
  
  <h1>
    <a href="./index.html">
      Pronto
    </a>
  </h1>
  <nav class="layout-nav">
    <ul><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands.html">commands</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_approve.html">commands/approve</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_approve.html#~processMentions">processMentions</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_archive.html">commands/archive</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_assign.html">commands/assign</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_assign.html#~getUserInput">getUserInput</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_assign.html#~msgPrompt">msgPrompt</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_assign.html#~processMentions">processMentions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_assign.html#~whileLoop">whileLoop</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_attendance.html">commands/attendance</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_connected.html">commands/connected</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_evaluate.html">commands/evaluate</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_evaluate.html#~convertToString">convertToString</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_evaluate.html#~findBreakIndex">findBreakIndex</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_evaluate.html#~removeSensitive">removeSensitive</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_help.html">commands/help</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_leave.html">commands/leave</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_leavefor.html">commands/leavefor</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_lesson.html">commands/lesson</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_lesson.html#~getNumberInput">getNumberInput</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_lesson.html#~processMentions">processMentions</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="module-commands_lesson.html#~serialiseResources">serialiseResources</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_ping.html">commands/ping</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_purge.html">commands/purge</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_restart.html">commands/restart</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_seen.html">commands/seen</a></span></li><li class="nav-heading"><span class="nav-item-type type-module" title="module">M</span><span class="nav-item-name is-module"><a href="module-commands_uptime.html">commands/uptime</a></span></li></ul><ul><li class="nav-heading">Namespaces</li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="commands.html">commands</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="config.html">config</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="handlers.html">handlers</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="handlers.html#.commandLoader">commandLoader</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="handlers.html#.createGuild">createGuild</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="handlers.html#.database">database</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="handlers.html#.permissionsCheck">permissionsCheck</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="handlers.html#.upsertCommands">upsertCommands</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="models.html">models</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="modules.html">modules</a></span></li><li class="nav-heading"><span class="nav-item-type type-namespace" title="namespace">N</span><span class="nav-item-name is-namespace"><a href="pronto.html">pronto</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="pronto.html#.bot">bot</a></span></li><li class="nav-item"><span class="nav-item-type type-member" title="member">M</span><span class="nav-item-name is-member"><a href="pronto.html#.version">version</a></span></li><li class="nav-item"><span class="nav-item-type type-function" title="function">F</span><span class="nav-item-name is-function"><a href="pronto.html#~eventHandler">eventHandler</a></span></li></ul>
  </nav>
</header>


<main class="layout-main  layout-content--source">
  <div class="container">
    <p class="page-kind">source</p>
    <h1 class="page-title">commands/leavefor.js</h1>
    



    

<section>
    <article>
        <pre id="source" class="source-page line-numbers"><code class="language-js">'use strict';

const Discord = require('discord.js');
// eslint-disable-next-line no-unused-vars
const Typings = require('../typings');

const { capitalise, commandError, dateTimeGroup, prefixCommand, remove, sendDirect, sendMsg, successReact } = require('../modules');

/**
 * Complete the \&lt;Command> object from a \&lt;BaseCommand>
 * @module commands/leavefor
 * @param {Discord.Guild} guild The \&lt;Guild> that the member shares with the bot
 * @returns {Promise&lt;Typings.Command>} The complete \&lt;Command> object with a \&lt;Command.execute()> method
 */
module.exports = async guild => {
	const { ids: { attendanceID }, commands: { help, leave, leaveFor }, colours } = await require('../handlers/database')(guild);

	/**
	 * Process a leave request submitted on behalf of someone else
	 * @param {Typings.CommandParameters} parameters The \&lt;CommandParameters> to execute this command
	 */
	leaveFor.execute = async ({ msg, args }) => {
		const { bot } = require('../pronto');

		// Extract the mentioned absentee from the command message
		const absentee = msg.mentions.members.first();

		try {
			// Ensure there was at least one &lt;GuildMember> mentioned
			if (msg.mentions.members.size === 0) throw 'You must tag a user.';

			// Ensure no mentioned members are a bot
			else if (msg.mentions.members.some(mention => mention.user.bot)) throw 'You cannot submit leave for a bot!';

			// Ensure there was only member mentioned
			else if (msg.mentions.members.size > 1) throw 'You must submit leave individually.';

			// Ensure there are at least some remarks
			else if (args.length &lt; 2) throw 'Insufficient remarks.';
		}

		catch (error) { return commandError(msg, error, leaveFor.error); }

		// Success react to command message
		successReact(msg);

		// Remove the mentioned &lt;GuildMember> from the command arguments
		args = remove(args, `&lt;@!${absentee.user.id}>`);

		// Create leave request embed
		const attendanceEmbed = new Discord.MessageEmbed()
			.setTitle('Leave Request (For)')
			.setColor(colours.leave)
			.setAuthor(absentee.displayName, absentee.user.displayAvatarURL({ dynamic: true }))
			.setDescription(`**${msg.member.displayName}** has submitted leave for **${absentee.displayName}** in **#${msg.channel.name}**`)
			.addFields(
				{ name: 'Absentee', value: absentee.toString() },
				{ name: 'Channel', value: msg.channel.toString() },
				// Capitalise the first letter of the command arguments and add them to a 'Remarks' field
				{ name: 'Remarks', value: capitalise(args.join(' ')) },
			)
			.setFooter(await dateTimeGroup());

		// Create confirmation embed
		const directEmbed = new Discord.MessageEmbed()
			.setTitle('Leave Request (For)')
			.setColor(colours.leave)
			.setAuthor(msg.guild.name, msg.guild.iconURL({ dynamic: true }))
			.setDescription(`Hi **${msg.member.displayName}**, your submission of leave for **${absentee.displayName}** has been received.`)
			.addField('Channel', msg.channel.toString())
			.addField('Remarks', capitalise(args.join(' ')))
			.setFooter(await dateTimeGroup());

		// Create notice embed to inform absentee that a request has been made on their behalf
		const absenteeEmbed = new Discord.MessageEmbed()
			.setTitle('Leave Request (For)')
			.setColor(colours.leave)
			.setAuthor(msg.guild.name, msg.guild.iconURL({ dynamic: true }))
			.setDescription(`**${msg.member.displayName}** has submitted leave for you in **#${msg.channel.name}**.`)
			.addField('Channel', msg.channel.toString())
			.addField('Remarks', capitalise(args.join(' ')))
			.setFooter(`Reply with '${await prefixCommand(help, guild)} ${leave.command}' to learn how to request leave for yourself.`);

		// Get the guild's attendance channel
		const attendanceChannel = bot.channels.cache.get(attendanceID);

		// Send the embeds to their respective destinations
		sendMsg(attendanceChannel, { embeds: [attendanceEmbed] });
		sendDirect(msg.author, { embeds: [directEmbed] }, msg.channel);
		sendDirect(absentee, { embeds: [absenteeEmbed] }, msg.channel, true);
	};

	return leaveFor;
};</code></pre>
    </article>
</section>




  </div>
</main>

<footer class="layout-footer">
  <div class="container">
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Mon Dec 06 2021 23:07:02 GMT+1300 (New Zealand Daylight Time)
  </div>
</footer>



<script src="scripts/prism.dev.js"></script>
</body>
</html>
